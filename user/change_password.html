<!DOCTYPE html>
<html>

<head>
    <title>Dashboard</title>
    <meta charset="utf-8" name="viewport" content="width=device-width,intial-scale=1">
    <link rel="stylesheet" type="text/css" href="../bootstrap-4.4.1/css/bootstrap.min.css">
    <script type="text/javascript" src="../bootstrap-4.4.1/js/juqery_latest.js"></script>
    <script type="text/javascript" src="../bootstrap-4.4.1/js/bootstrap.min.js"></script>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="user_dashboard.html">Library Management System (LMS)</a>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" data-toggle="dropdown">My Profile </a>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="view_profile.html">View Profile</a>
                        <div class="dropdown-divider"></div>

                        <a class="dropdown-item" href="change_password.html">Change Password</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../front_page.html">Logout</a>
                </li>
            </ul>
        </div>
    </nav><br>
    <span><marquee>This is library mangement system. Library opens at 8:00 AM and close at 8:00 PM</marquee></span><br><br>
    <center>
        <h4>Change Student Password</h4><br></center>
    <div class="row">
        <div class="col-md-4"></div>
        <div class="col-md-4">
            <form id="changePasswordForm">
                <!-- <div class="form-group">
                    <label for="password">Enter Password:</label>
                    <input type="password" class="form-control" name="old_password">
                </div> -->
                <div class="form-group">
                    <label for="New Password">Enter New Password:</label>
                    <input type="password" id="new_password" name="new_password" class="form-control">
                </div>
                <button type="submit" name="update" class="btn btn-primary">Update Password</button>
            </form>
        </div>
        <div class="col-md-4"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const changePasswordForm = document.getElementById('changePasswordForm');
            const messageElement = document.getElementById('message');
            const userId = localStorage.getItem("user_email");

            changePasswordForm.addEventListener("submit", function(event) {
                event.preventDefault();

                const newPassword = document.getElementById('new_password').value;

                // Validate the new password (you may want to add more validation)
                if (newPassword.length === 0) {
                    showMessage('Please enter a new password.', 'error');
                    return;
                }

                // Perform AJAX request to change the password
                fetch(`http://localhost:5000/library/changepass?user_id=${userId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            new_password: newPassword
                        }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        showMessage(data.message, 'success');
                        changePasswordForm.reset();
                    })
                    .catch(error => {
                        showMessage('Error changing password. Please try again.', 'error');
                    });
            });

            function showMessage(message, type) {
                messageElement.textContent = message;
                messageElement.className = type;
            }
        });
    </script>
</body>


</html>